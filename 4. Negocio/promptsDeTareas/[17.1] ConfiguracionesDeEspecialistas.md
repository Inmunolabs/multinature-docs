# [17] Especialistas

## [17.1] Configuraciones de especialistas

Genera un archivo CSV con las siguientes tareas, siguiendo el formato que te pasé antes:

- ✅ [17005] Crear la tabla de configuraciones de especialista

  Contexto:
  **Nombre de la Tabla**: `specialist_settings`
  **Nombres de las Columnas**:
  | Nombre en Español | Nombre en Inglés | Tipo de Dato | Valor por Defecto |
  |-----------------------------------|--------------------------------|-------------------|-------------------|
  | Cobro de anticipo de consulta | `charge_advance_payment` | `DOUBLE` | `FALSE` |
  | Cobro de consulta | `charge_per_consultation` | `BOOLEAN` | `FALSE` |
  | Cobro mensual | `monthly_charge` | `BOOLEAN` | `FALSE` |
  | Recibir correos | `receive_emails` | `BOOLEAN` | `TRUE` |
  **Posible Código SQL para Crear la Tabla**:
  Verificarlo bien

  ```sql
  CREATE TABLE specialist_settings (
      specialist_id VARVHAR(36) PRIMARY KEY,
      charge_advance_payment DOUBLE DEFAULT 0.0,
      charge_per_consultation BOOLEAN DEFAULT FALSE,
      monthly_charge BOOLEAN DEFAULT FALSE,
      receive_emails BOOLEAN DEFAULT TRUE,
      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
      updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
      FOREIGN KEY (specialist_id) REFERENCES users(id) ON DELETE CASCADE
  );
  ```

  **Explicación de la Estructura**:

  1. `specialist_id`: Relación con la tabla `specialists` (asumiendo que existe).
  2. `charge_advance_payment`: Define si se cobra un anticipo para la confirmación de citas (mayor a 0) y cuánto se cobrará.
  3. `charge_per_consultation`: Define si se cobra por consulta desde el sistema.
  4. `monthly_charge`: Indica si hay un cobro mensual por paciente.
  5. `receive_emails`: Indica si el especialista recibe o deja de recibir correos.

  Tags: back
  Assignee: Samuel Reveles

- ✅ [17006] Crear endpoint para la creación de configuraciones de especialista

  Contexto: El endpoint `POST {{usersHost}}/specialists/config` debe crearse desde el users-api desde un nuevo router `specialists.js` y debe permitir la creación de configuraciones de especialista persistiendolas en la base de datos, tabla: `specialist_settings`.
  La creación del nuevo router (`specialists.js`) requiere cambiar el nombre del viejo router a `users.js` y que se cree un index (archivo `index.js`) de routers donde se exporten esos dos routers. El archivo server tendrá que hacer uso del index de routers. Solo el perfil de especialista y admin pueden ingresar a este endpoint
  Tags: back
  Assignee: Samuel Reveles

- ✅ [17007] Crear endpoint para la obtención de las configuraciones de especialista

  Contexto: El endpoint `GET {{usersHost}}/specialists/config` debe crearse desde el users-api desde el nuevo router `specialists.js` y debe permitir la obteción de las configuraciones del especialista conseguidas desde la base de datos, tabla: `specialist_settings`. Solo el perfil de especialista y admin pueden ingresar a este endpoint
  Tags: back
  Assignee: Samuel Reveles

- ✅ [17008] Crear endpoint para la actualización de las configuraciones de especialista

  Contexto: El endpoint `PATCH {{usersHost}}/specialists/config` debe crearse desde el users-api desde el nuevo router `specialists.js` y debe permitir la actualización de configuraciones de especialista persistiendo los cambios en la base de datos, tabla: `specialist_settings`. Solo el perfil de especialista y admin pueden ingresar a este endpoint
  Tags: back
  Assignee: Samuel Reveles

Genera un archivo CSV con las siguientes tareas, siguiendo el formato que te pasé antes:

- ✅ [17009] Crear flujo para actualización de un perfil de usuario a especialista

  Contexto: El **Flujo para actualizar a un usuario como especialista** conlleva varios puntos que se pueden dividir seis pasos:

  1. **Seleccionar especialidades** (Entrenador y/o Nutricionista). Seleccionador con las especialidades que se cuentan en el sistema. (backend pendiente) (El desarrollo de la funcionalidad se hara en una nueva tarea)
  2. **Cargar Constancia de Conocimiento** (Cédula, Certificados, etc.). (Opcional) (backend pendiente) (El desarrollo de la funcionalidad se hara en una nueva tarea)
  3. **Formulario de Alta de Pacientes**. (Opcional) (backend pendiente) (El desarrollo de la funcionalidad se hara en una nueva tarea)
  4. **Formulario de Configuraciones del especialista**.
  5. Subir **Material de apoyo**. La intención de este punto es permitir al especialista subir archivos como fotografías, documentes como pdf, word, etc. (Opcional) (backend pendiente) (El desarrollo de la funcionalidad se hara en una nueva tarea)
  6. **Solicitud de datos fiscales y cuentas bancarias**. (Opcional) (backend pendiente)

  - Esta tarea se compone de dos puntos:

  1. La creación visual del flujo de seis pasos, tal como el flujo similar de registro de usuarios en Inmuno, donde cada paso es una nueva pestaña. Para este caso los pasos que son opcionales deberán contener un botón de "Omitir" para brincarse el paso.
  2. Y el desarrollo funcional de los pasos 4 y 6.
     1. El paso 4 radica en el consumo del endpoint `POST {{usersHost}}/specialists/config` de la tarea _[17006] Crear endpoint para la creación de configuraciones de especialista_
        El formulario deberá contener los siguientes puntos:
        - Cobro de anticipo de consulta. `charge_advance_payment`: Define si se cobra un anticipo para la confirmación de citas (mayor a 0) y cuánto se cobrará.
        - Cobro de consulta. `charge_per_consultation`: Define si se cobra por consulta desde el sistema.
        - Cobro mensual. `monthly_charge`: Indica si hay un cobro mensual por paciente.
        - Recibir correos. `receive_emails`: Indica si el especialista recibe o deja de recibir correos.
          Este punto incluye el maquetado del formulario y el consumo del endpoint `POST {{usersHost}}/specialists/config`
     2. En el paso 6 se deberán copiar los formularios y el funcionamiento de Inmuno para completar la solicitud de datos fiscales y cuentas bancarias

  Tags: front
  Assignee: Diego Martin Ponce

- ✅ [17010] Crear vista y formulario para actualizar las Configuraciones del especialista

  Contexto: El objetivo de esta vista es permitir al especialista actualizar sus configuraciones agregadas en el **Formulario de Configuraciones del especialista**, paso 4 del **Flujo para actualizar a un usuario como especialista**.
  La vista debe tener la opción para actualizar las siguientes configuraciones:

  - Cobro de anticipo de consulta. `charge_advance_payment`: Define si se cobra un anticipo para la confirmación de citas (mayor a 0) y cuánto se cobrará.
  - Cobro de consulta. `charge_per_consultation`: Define si se cobra por consulta desde el sistema.
  - Cobro mensual. `monthly_charge`: Indica si hay un cobro mensual por paciente.
  - Recibir correos. `receive_emails`: Indica si el especialista recibe o deja de recibir correos.
    Esta tarea incluye el acceso a este formulario, el maquetado del mismo y el consumo del endpoint `PATCH {{usersHost}}/specialists/config`

  Tags: front
  Assignee: Diego Martin Ponce

- ✅ [17011] Crear endpoint para la obtención de configuraciones del sistema

  Contexto: El objetivo de este endpoint es enviar las configuraciones del sistema. En esta primera entrega se deberán entregar todos los enums y constantes que tenemos en la base de datos, por ejemplo se deberán enviar:

  1. Todos los registros de la tabla `specialities` como:

  ```js
  specialities: [
    {
      id: '...',
      name: '...',
    },
    {...}
  ],
  ```

  2. Diferentes enum que admite la base de datos, como el enum del campo: - `genre` de la tabla `users`. - `profile` de la tabla `users`. IMPORTANTE, esta respuesta no deberá incluir los perfiles de administradores - `reason` de la tabla `bookings`. - `status` de la tabla `bookings`. - etc.

  ```js
  users:
    {
      genres: ['Mujer','Hombre','Otro'],
      profiles: ['Especialista','Usuario'],
    },
  bookings:
    {
      reason: ['Nutriólogo','Entrenamiento','Nutriólogo y Entrenamiento'],
      status: ['Por confirmar','Confirmada','Cancelada','Actualizada','Atendida'],
    }
  ```

  1. Etc.

  Cualquiera puede hacer esta consulta, no importa el token.
  Mostrar la respuesta a Miguel en espera de confirmación, una vez confirmada agregarla a la documentación.
  Tags: back
  Assignee: Samuel Reveles

- ✅ [17012] Consumir endpoint para obtener las configuraciones del sistema

  Contexto: El objetivo de este endpoint es para recibir las configuraciones del sistema. En esta primera entrega se deberán obtener todos los enums y constantes que tenemos en la base de datos y con ellos se pretende que sean utilizados en todos los "selects" del sistema, es decir se esperan recibir todas las configuraciones opcionales del sistema
  Endpoint a consultar: `GET {{usersHost}}/api/config`

  Tags: front
  Assignee: Diego Martin Ponce

- ✅ [17013] Consumir endpoint para seleccionar especialidades a un nuevo especialista

  Contexto: Del primer paso del **Flujo para actualizar a un usuario como especialista**.
  Asignar una especialidad a un especialista consultando el endpoint `POST {{usersHost}}/specialists/specialty/:id` (:id = specialtyId) del users-api.
  Para obtener las opciones de especialidades que el usuario puede seleccionar se deben consultar el endpoint `GET {{usersHost}}/api/config` previamente

  Tags: front
  Assignee: Diego Martin Ponce

- [1701?] Cargar Constancia de Conocimiento // TODO

- [1701?] Formulario de Alta de Pacientes // TODO

- [1701?] Subir Material de apoyo // TODO

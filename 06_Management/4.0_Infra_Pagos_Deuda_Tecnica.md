# 4.0 Infraestructura, Pagos y Deuda T√©cnica ‚Äì Documento Completo

## üéØ Objetivo

Asegurar que la infraestructura, los m√©todos de pago y la arquitectura interna sean **estables, seguras y mantenibles**, preparando el sistema para escalar.

---

# 1. EPICAS PRINCIPALES

## 1.1. MercadoPago ‚Äì Integraci√≥n Completa

### Problemas

- Flujo incompleto.
- Conciliaci√≥n limitada.
- Webhooks d√©biles.

### Entregables

- Flujo completo pagar ‚Üí confirmar ‚Üí conciliar.
- Webhooks s√≥lidos.
- Documentaci√≥n.

### Tareas

- [ ] Revisar `PaymentMethods.js`
- [ ] Implementar `createOrderURL`
- [ ] Manejo robusto de errores
- [ ] Webhooks finales
- [ ] Documentaci√≥n

---

## 1.2. Openpay ‚Äì Auditor√≠a y Limpieza

### Problemas

- Validaciones duplicadas.
- Datos inconsistentes.
- Duplicaci√≥n de m√©todos.

### Entregables

- Limpieza completa de Openpay.
- Unificaci√≥n de `paymentProvider`.

### Tareas

- [ ] Auditar `openpay.js`
- [ ] Eliminar consultas duplicadas
- [ ] Unificar provider

---

## 1.3. Wire4 ‚Äì Validaciones y Cuentas

### Problemas

- CLABE duplicada no validada correctamente.

### Tareas

- [ ] Revisar `accounts.js`
- [ ] Validaci√≥n robusta por usuario

---

## 1.4. Deuda T√©cnica Cr√≠tica

- Refactor `diets.js`
- Limpieza endpoints duplicados
- Validaci√≥n DDL vs Entities
- Eliminar legacy

---

## 1.5. Infra AWS / VPC

- Actualizar VPC productiva
- Documentar SG/Subnets
- Estandarizar Lambdas

---

## 1.6. Google Sheets Refresh Token

- Implementar refresh
- Centralizar uso del token

---

# 2. DEPENDENCIAS

1. Pagos dependen de limpieza de legacy
2. Refactor depende de Estabilidad Nutricional
3. VPC depende de regulaci√≥n de tr√°fico/seguridad

---

# 3. ASIGNACI√ìN POR ROL

## Miguel

- Arquitectura pagos
- VPC final
- Validaci√≥n t√©cnica

## Samuel

- Refactor y pagos
- Limpieza Openpay

## Erick

- Queries + deuda t√©cnica

## Cristopher

- Validaciones + soporte

## Leo

- QA de pagos y refactor

---

# 4. STORY POINTS

| √âpica                 | SP  |
| --------------------- | --- |
| MercadoPago           | 20  |
| Openpay               | 16  |
| Wire4                 | 8   |
| Deuda T√©cnica         | 34  |
| VPC                   | 21  |
| Google Sheets Refresh | 10  |

Total: **109 SP**

---

# 5. HORAS ESTIMADAS

| Rol        | Horas |
| ---------- | ----- |
| Miguel     | 40h   |
| Samuel     | 80h   |
| Erick      | 25h   |
| Cristopher | 20h   |
| Leo        | 12h   |

Total: **177h**

---

# 6. ENTREGAS POR SPRINT

## Sprint 3

- Auditor√≠a Openpay
- Flujo b√°sico MercadoPago
- Refactor inicial

## Sprint 4

- MercadoPago completo
- Openpay + Wire4 finalizados
- VPC actualizada
- Refresh token Google Sheets
- Deuda t√©cnica cerrada

---

# 7. RIESGOS

- Edge cases en pagos
- Deuda t√©cnica puede revelar m√°s fallas
- Cambios de VPC pueden causar downtime

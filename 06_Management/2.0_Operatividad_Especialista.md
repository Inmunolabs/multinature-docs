# 2.0 Operatividad del Especialista ‚Äì Documento Completo

## üéØ Objetivo

Garantizar que los especialistas puedan **crear, editar, visualizar y administrar men√∫s**, formularios y datos cl√≠nicos sin fricci√≥n.
Este bloque soporta **versi√≥n 1.0** y prepara el camino para **1.1**.

---

# 1. EPICAS PRINCIPALES

## _(Nice-to-have)_ 1.0. SMAE ‚Äì Normalizaci√≥n y Cache

### Problemas actuales

- Etiquetas mixtas (may√∫sculas, tildes, sin√≥nimos).
- SMAE cargado _ad-hoc_ en cada c√°lculo ‚Üí bajo performance.

### Entregables

- Normalizaci√≥n de etiquetas (acentos, may√∫sculas, sin√≥nimos).
- Carga del cat√°logo en startup.
- Cache local para evitar queries repetidas.

### Tareas

- [ ] Crear normalizador global de etiquetas.
  - [ ] Crear m√≥dulo `smaeNormalizer.js`.
  - [ ] Convertir strings ‚Üí snake_case.
  - [ ] Remover acentos.
  - [ ] Unificar nombres similares (ej. ‚ÄúAguacate Hass‚Äù vs ‚ÄúAguacate‚Äù).
  - [ ] Mapa de sin√≥nimos.
- [ ] Cargar SMAE completo en memoria al iniciar la API.
  - [ ] Crear servicio global `SMAE_CACHE`.
  - [ ] Cargar grupos, subgrupos y equivalentes al iniciar.
  - [ ] Exponer getters r√°pidos.
  - [ ] Evitar queries duplicadas en menus/diets.
- [ ] Documentar estructura final de SMAE.

---

## ‚úÖ 1.1. CRUD de Men√∫s (Manual + IA)

### Problemas actuales

- Men√∫s generados por IA no son editables desde la interfaz.
- Men√∫s manuales e IA est√°n en vistas separadas.
- No hay historial/versionado.
- DTO no est√° estandarizado.

### Entregables

- CRUD completo (crear, leer, actualizar, eliminar).
- Estructura √∫nica: men√∫ manual o IA.
- Editor visual unificado.
- Historial y versionado.
- Validaciones de permisos (`userBelongsToSpecialist`).
- DTO estandarizado para frontend.

### Tareas

- [ ] Endpoint CREATE men√∫.
- [ ] Endpoint UPDATE men√∫.
- [ ] Endpoint DELETE men√∫.
- [ ] Endpoint LIST por paciente.
- [ ] Unificar estructura IA vs manual.
- [ ] Integrar versionado.
- [ ] Documentar formato final: `/doc/menus-structure.md`.

---

## ‚úÖ 1.2. Edici√≥n de Men√∫s IA

### Problemas

- La IA produce JSON r√≠gido.
- Especialistas no pueden ajustar porciones, horarios o platillos.
- Falta trazabilidad de cambios.

### Entregables

- Editor visual completo.
- Guardar cambios en JSON.
- Trazabilidad (qui√©n lo cambi√≥, cu√°ndo).
- Ajustes din√°micos a partir del cat√°logo SMAE corregido.

### Tareas

- [ ] Endpoint PATCH para cambios granulares.
- [ ] UI de edici√≥n (Diego).
- [ ] Ajuste de horario/porciones/platillos.
- [ ] Guardar cambios con diff.
- [ ] Bit√°cora de cambios (`menus_history`).

---

## _(Nice-to-have)_ 1.3. Mejoras Formularios Cl√≠nicos de Pacientes

### Problemas

- Flujo de llenado lento.
- Inconsistencia en unidades.
- Conceptos duplicados.
- Validaciones d√©biles.
- UX confusa para especialistas.

### Entregables

- Mejorar agrupaci√≥n l√≥gica.
- Unificar unidades.
- Flujo lineal optimizado.
- Validaciones cl√≠nicas completas.
- Preparaci√≥n para hist√≥rico graficable.

### Tareas

- [ ] Agrupaci√≥n l√≥gica de conceptos.
- [ ] Validaciones por tipo (peso, talla, glucosa, presi√≥n).
- [ ] Normalizar unidades.
- [ ] UI mejorada (Diego + Antoine).
- [ ] Documentaci√≥n: `/doc/forms-structure.md`.

---

## _(Nice-to-have)_ 1.4. Historial Cl√≠nico Estructurado

### Problemas

- Navegaci√≥n complicada.
- Historial disperso entre tablas.
- Pocas gr√°ficas.
- Dif√≠cil para especialistas consultar evoluci√≥n.

### Entregables

- Estructura temporal clara.
- B√∫squeda por tipo de informaci√≥n.
- Filtros (signos vitales, bioqu√≠micos, antropometr√≠a).
- Gr√°ficas de evoluci√≥n.
- Exportaci√≥n PDF.

### Tareas

- [ ] Nueva vista frontend.
- [ ] API para filtrado.
- [ ] API para agrupaci√≥n temporal.
- [ ] Gr√°ficas (ReactCharts).
- [ ] Exportaci√≥n PDF.
- [ ] Documentaci√≥n: `/doc/clinical-history.md`.

---

## ‚úÖ 1.5. Creaci√≥n de Dieta a partir de la propuesta del Agente de Dietas

### Problemas

- El Agente de dietas responde con una propuesta de dieta, esta no es creada sino hasta que el especialista lo autoriza.

### Entregables

- Crear en base de datos la dieta completa del paciente.

### Tareas

- Crear en base de datos la dieta completa del paciente.

---

# 2. DEPENDENCIAS

1. CRUD de men√∫s depende de:
   - Estabilidad Nutricional (SMAE + MealTimes + Porciones + GET)
2. Edici√≥n IA depende de:
   - GET estable
   - DTO consistente
3. Formularios dependen de:
   - Migraciones corregidas
   - Validaciones cl√≠nicas
4. Historial cl√≠nico depende de:
   - Formularios coherentes
   - DTO graficable

---

# 3. ASIGNACI√ìN POR ROL

## Miguel

- Arquitectura CRUD men√∫s.
- Definici√≥n DTO backend-frontend.
- Trazabilidad de cambios IA.

## Samuel

- Endpoints CRUD.
- Normalizaci√≥n DTO.
- Versionado.
- Integraci√≥n edici√≥n IA.

## Diego

- UI completa: CRUD + Editor IA + formularios cl√≠nicos + historial.
- Gr√°ficas de evoluci√≥n.

## Antoine

- Dise√±o cl√≠nico.
- UX de formularios.
- Flujo de historial.
- **_NOTA:_** Antoine ya desarrollo la Epica [1.5. Creaci√≥n de Dieta a partir de la propuesta del Agente de Dietas](#15-creaci√≥n-de-dieta-a-partir-de-la-propuesta-del-agente-de-dietas)

## Erick

- Endpoints secundarios.
- Validaciones.
- Soporte a Samuel.

## Cristopher

- Limpieza DTO.
- Formatos de historial.

## Leo

- QA de formularios.
- QA de CRUD men√∫s.
- QA de editor IA.

---

# 4. STORY POINTS

| √âpica                | SP  |
| -------------------- | --- |
| CRUD Men√∫s           | 34  |
| Editor IA            | 21  |
| Formularios Cl√≠nicos | 20  |
| Historial Cl√≠nico    | 26  |

Total: **101 SP**

---

# 5. HORAS TOTALES ESTIMADAS

| Rol        | Horas |
| ---------- | ----- |
| Miguel     | 35h   |
| Samuel     | 70h   |
| Diego      | 48h   |
| Antoine    | 20h   |
| Erick      | 28h   |
| Cristopher | 22h   |
| Leo        | 18h   |

Total estimado: **241h**

---

# 6. ENTREGA POR SPRINT

## Sprint 2 ‚Äì Rumbo a 1.0

- CRUD Men√∫s base
- DTO unificado
- Editor IA funcional en 60%
- Formularios reorganizados

## Sprint 3 ‚Äì Rumbo a 1.1

- Historial cl√≠nico completo
- Editor IA final
- Validaciones finales
- Exportaci√≥n PDF

---

# 7. RIESGOS

- DTO inestable ‚Üí rompe frontend.
- Formularios a√∫n dependientes de migraciones viejas.
- Historial cl√≠nico requiere refinamiento continuo.
- Editor IA puede crecer en complejidad.

---

# 8. DOCUMENTACI√ìN FINAL

- `/doc/menus-structure.md`
- `/doc/menus-history.md`
- `/doc/forms-structure.md`
- `/doc/clinical-history.md`
